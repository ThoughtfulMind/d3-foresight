<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-03-25 Sun 23:51 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>D3-foresight documentation</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Abhinav Tushar" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="./assets/d3-foresight.js"></script>
<script src="./assets/script.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,800" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono" />
<link rel="stylesheet" href="./assets/css/main.css" />
<link rel="stylesheet" href="./assets/css/overrides.css" />
<link rel="stylesheet" href="./assets/fontello/fontello.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div class="page-header">
<p>
   <div class="page-meta small">Document last updated 2018-03-25 Sun 23:51</div>
</p>
<h1>D3 <em>Foresight</em></h1>
</div>

<p>
<a href="https://travis-ci.org/reichlab/d3-foresight" class="image-link"><img src="https://img.shields.io/travis/reichlab/d3-foresight/master.svg?style=for-the-badge" /></a>
<a href="https://www.npmjs.com/package/d3-foresight" class="image-link"><img src="https://img.shields.io/npm/v/d3-foresight.svg?style=for-the-badge" /></a>
<a href="https://www.npmjs.com/package/d3-foresight" class="image-link"><img src="https://img.shields.io/npm/l/d3-foresight.svg?style=for-the-badge" /></a>
<a href="https://github.com/reichlab/d3-foresight/issues" class="image-link"><img src="https://img.shields.io/github/issues/reichlab/d3-foresight.svg?style=for-the-badge" /></a>
</p>

<p>
<a href="https://github.com/feross/standard" class="image-link"><img src="https://cdn.rawgit.com/feross/standard/master/badge.svg" /></a>
</p>

<p>
D3 Foresight is a <a href="https://github.com/d3/d3">d3</a> based library for visualizing time series forecasts
interactively. At a <i>time point</i>, a general time series model trying to predict a
single variable series (like temperature) makes forecasts for some time points
in the future with some uncertainty described by probability distributions.
Other than these predictions, it might also provide an estimate of <i>peak</i> and some
<i>onset/outbreak</i> point (as defined by a baseline). This visualizations in this
library try to cover these cases. See <a href="http://reichlab.io/flusight">reichlab/flusight</a> for a demo.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6afcc24">Setting up</a></li>
<li><a href="#org9fc2245">TimeChart</a>
<ul>
<li><a href="#org2f0878c">Basic plot</a></li>
<li><a href="#orga34e9f6"><span class="todo TODO">TODO</span> Advanced plots</a></li>
</ul>
</li>
<li><a href="#orgd8a2401"><span class="todo TODO">TODO</span> DistributionChart</a></li>
<li><a href="#org9cf7ad3">Hooks</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6afcc24" class="outline-2">
<h2 id="org6afcc24">Setting up</h2>
<div class="outline-text-2" id="text-org6afcc24">
<p>
The library requires <a href="https://d3js.org/">d3</a> and <a href="https://momentjs.com">momentjs</a> as external dependencies. To build
foresight itself, use <code>npm compile</code> (for <code>./dist/d3-foresight.js</code>) or <code>npm build</code> (for
<code>./dist/d3-foresight.min.js</code>). The library is also available on npm as
<a href="https://www.npmjs.com/package/d3-foresight">d3-foresight</a>. For browser, include these in your html:
</p>

<pre class="example">
&lt;script src="https://d3js.org/d3.v4.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"&gt;&lt;/script&gt;
&lt;script src="./dist/d3-foresight.min.js"&gt;&lt;/script&gt;
</pre>

<p>
Additionally, a few icons (in the legend) have an icon font dependency. The css
for that can be added using:
</p>

<pre class="example">
&lt;link rel="stylesheet" href="./assets/fontello/fontello.css" /&gt;
</pre>
</div>
</div>

<div id="outline-container-org9fc2245" class="outline-2">
<h2 id="org9fc2245">TimeChart</h2>
<div class="outline-text-2" id="text-org9fc2245">
<p>
A <code>TimeChart</code> displays the time series to be predicted and the models'
predictions. Beyond the very minimal plots involving only model forecasts, it
can show the following items:
</p>

<ul class="org-ul">
<li>The actual time series to be predicted.</li>
<li>The <i>observed</i> time series. This might be different from the actual series if
the truth is revised (e.g. due to reporting delays in the incident count for
certain disease).</li>
<li>Baseline value for the year/season.</li>
<li>History of the series over some past years/seasons.</li>
<li>Additional prediction information from models like
<ul class="org-ul">
<li>Confidence intervals</li>
<li>Peak and onset prediction</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org2f0878c" class="outline-3">
<h3 id="org2f0878c">Basic plot</h3>
<div class="outline-text-3" id="text-org2f0878c">
<p>
In this section, we will plot a very basic visualization involving one model
providing random numbers as forecasts for a year.
</p>
</div>

<div id="outline-container-org3930a87" class="outline-4">
<h4 id="org3930a87">Configuration</h4>
<div class="outline-text-4" id="text-org3930a87">
<p>
Time in foresight is represented using <code>timePoints</code> which is an array mapping to
discrete date/time values. As of now, foresight supports the following two type
of time points:
</p>

<ol class="org-ol">
<li><code>regular-week</code></li>
<li><code>mmwr-week</code> based on <a href="https://wwwn.cdc.gov/nndss/document/MMWR_Week_overview.pdf">MMWR definitions</a></li>
</ol>

<p>
Both are <i>week</i> based points and are represented as objects like shown:
</p>

<div class="org-src-container">
<pre class="src src-json"><span class="org-rainbow-delimiters-depth-1">{</span>
  week: <span class="org-highlight-numbers-number">20</span>,
  year: <span class="org-highlight-numbers-number">2016</span>
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Lets work on regular weeks for the year 2016. Our week choice can be passed to
foresight charts using a config object which is the following in our case:
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">let</span> <span class="org-variable-name">config</span> = <span class="org-rainbow-delimiters-depth-1">{</span>
  pointType: <span class="org-string">'regular-week'</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">This is optional since regular-week is default</span>
  axes: <span class="org-rainbow-delimiters-depth-2">{</span>
    y: <span class="org-rainbow-delimiters-depth-3">{</span>
      title: <span class="org-string">'Random numbers'</span> <span class="org-comment-delimiter">// </span><span class="org-comment">Title for the y axis</span>
    <span class="org-rainbow-delimiters-depth-3">}</span>
  <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc210437" class="outline-4">
<h4 id="orgc210437">Data</h4>
<div class="outline-text-4" id="text-orgc210437">
<p>
At minimum, <code>TimeChart</code> expects an array of time points and an array of model
data. The time points in our case go from week 1 to week 52 of 2016 and can be
represented as:
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">let</span> <span class="org-variable-name">timePoints</span> = <span class="org-rainbow-delimiters-depth-1">[</span>...Array<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">51</span><span class="org-rainbow-delimiters-depth-2">)</span>.keys<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">]</span>.map<span class="org-rainbow-delimiters-depth-1">(</span>w =&gt; <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-keyword">return</span> <span class="org-rainbow-delimiters-depth-3">{</span> week: w + <span class="org-highlight-numbers-number">1</span>, year: <span class="org-highlight-numbers-number">2016</span> <span class="org-rainbow-delimiters-depth-3">}</span>
<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
At each time point, our model provides predictions for the next 10 time points.
These predictions are represented in an array of same size as the time points.
For when the model has no predictions, we put in <code>null</code>.
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="org-comment-delimiter">// </span><span class="org-comment">Random sequence generator</span>
<span class="org-keyword">function</span> <span class="org-function-name">rseq</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">n</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-keyword">let</span> <span class="org-variable-name">seq</span> = <span class="org-rainbow-delimiters-depth-2">[</span>Math.random<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-keyword">for</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-variable-name">i</span> = <span class="org-highlight-numbers-number">1</span>; i &lt; n; i++<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span>
    seq.push<span class="org-rainbow-delimiters-depth-3">(</span>Math.random<span class="org-rainbow-delimiters-depth-4">()</span> * <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">1</span> + seq<span class="org-rainbow-delimiters-depth-5">[</span>i - <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-5">]</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">return</span> seq
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Predictions look like [{ series: [{ point: 0.5 }, { point: 1.2 } ...] }, ..., null, null]</span>
<span class="org-keyword">let</span> <span class="org-variable-name">predictions</span> = timePoints.map<span class="org-rainbow-delimiters-depth-1">(</span>tp =&gt; <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>tp.week &gt; <span class="org-highlight-numbers-number">30</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">We only predict upto week 30</span>
    <span class="org-keyword">return</span> <span class="org-constant">null</span>
  <span class="org-rainbow-delimiters-depth-3">}</span> <span class="org-keyword">else</span> <span class="org-rainbow-delimiters-depth-3">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Provide 10 week ahead predictions</span>
    <span class="org-keyword">return</span> <span class="org-rainbow-delimiters-depth-4">{</span>
      series: rseq<span class="org-rainbow-delimiters-depth-5">(</span><span class="org-highlight-numbers-number">10</span><span class="org-rainbow-delimiters-depth-5">)</span>.map<span class="org-rainbow-delimiters-depth-5">(</span>r =&gt; <span class="org-rainbow-delimiters-depth-6">{</span> <span class="org-keyword">return</span> <span class="org-rainbow-delimiters-depth-7">{</span> point: r <span class="org-rainbow-delimiters-depth-7">}</span> <span class="org-rainbow-delimiters-depth-6">}</span><span class="org-rainbow-delimiters-depth-5">)</span>
    <span class="org-rainbow-delimiters-depth-4">}</span>
  <span class="org-rainbow-delimiters-depth-3">}</span>
<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Finally we put everything together in a single object. Notice the extra metadata
involved in putting together the values for the model:
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">let</span> <span class="org-variable-name">data</span> = <span class="org-rainbow-delimiters-depth-1">{</span>
  timePoints,
  models: <span class="org-rainbow-delimiters-depth-2">[</span>
    <span class="org-rainbow-delimiters-depth-3">{</span>
      id: <span class="org-string">'mod'</span>,
      meta: <span class="org-rainbow-delimiters-depth-4">{</span>
        name: <span class="org-string">'Name'</span>,
        description: <span class="org-string">'Model description here'</span>,
        url: <span class="org-string">'http://github.com'</span>
      <span class="org-rainbow-delimiters-depth-4">}</span>,
      predictions
    <span class="org-rainbow-delimiters-depth-3">}</span>
  <span class="org-rainbow-delimiters-depth-2">]</span>
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc8d0768" class="outline-4">
<h4 id="orgc8d0768">Plotting</h4>
<div class="outline-text-4" id="text-orgc8d0768">
<p>
The life cycle of <code>TimeChart</code> involves the following stages:
</p>

<ol class="org-ol">
<li>Initialization</li>
<li>Plotting</li>
<li>Updating</li>
</ol>

<div class="org-src-container">
<pre class="src src-js"><span class="org-comment-delimiter">// </span><span class="org-comment">1. Initialize</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Setup the id of div where we are going to plot</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Also pass in config options</span>
<span class="org-keyword">let</span> <span class="org-variable-name">timeChart</span> = <span class="org-keyword">new</span> <span class="org-type">d3Foresight.TimeChart</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'#timechart'</span>, config<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">2. Plot</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Provide the data for the complete year</span>
timeChart.plot<span class="org-rainbow-delimiters-depth-1">(</span>data<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">3. Update</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Move to the given index in the set of timePoints</span>
timeChart.update<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Or simply use</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">timeChart.moveForward()</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">timeChart.moveBackward()</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Lets also save the timechart object in global namespace</span>
window.timeChart = timeChart
</pre>
</div>

<br><br>
<div><div id="timechart"></div></div>

<p>
If you are able to see the plot above (which you should be, else file an <a href="https://github.com/reichlab/d3-foresight/issues">issue</a>),
you should be able to move around by clicking the arrow buttons in legend. You
might also be noticing that nothing happens when you <i>click</i> on the chart. This is
because we need to register hook functions for events like clicks. To add the
<i>on click interactivity</i>, we need to register a function which calls
<code>timeChart.update</code> on a mouse click event. Press execute button below to set up
the required hook:
</p>

<textarea id="mouse-code">
timeChart.addHook(
  d3Foresight.events.JUMP_TO_INDEX,
  idx => timeChart.update(idx)
)
</textarea>
<div class="btn" id="mouse-btn">execute</div>

<p>
Now, you should be able to use mouse clicks to move in the plot above. See the
section on <a href="#org9cf7ad3">Hooks</a> for more description.
</p>
</div>
</div>
</div>

<div id="outline-container-orga34e9f6" class="outline-3">
<h3 id="orga34e9f6"><span class="todo TODO">TODO</span> Advanced plots</h3>
</div>
</div>

<div id="outline-container-orgd8a2401" class="outline-2">
<h2 id="orgd8a2401"><span class="todo TODO">TODO</span> DistributionChart</h2>
</div>
<div id="outline-container-org9cf7ad3" class="outline-2">
<h2 id="org9cf7ad3">Hooks</h2>
<div class="outline-text-2" id="text-org9cf7ad3">
<p>
Charts can call user defined functions when movement events are triggered inside
(e.g. by clicking on movement buttons or clicking on the overlay). To register
your functions to be called on these events, you can use <code>addHook</code>.
</p>

<div class="org-src-container">
<pre class="src src-js">timeChart.addHook<span class="org-rainbow-delimiters-depth-1">(</span>d3Foresight.events.FORWARD_INDEX, <span class="org-rainbow-delimiters-depth-2">()</span> =&gt; <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">This is triggered when an event moves the</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">visualization forward in time one tick</span>
  console.log<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'chart moved forward'</span><span class="org-rainbow-delimiters-depth-3">)</span>
<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>

timeChart.addHook<span class="org-rainbow-delimiters-depth-1">(</span>d3Foresight.events.BACKWARD_INDEX, <span class="org-rainbow-delimiters-depth-2">()</span> =&gt; <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">This is triggered when an event moves the</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">visualization backward in time one tick</span>
  console.log<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'chart moved backward'</span><span class="org-rainbow-delimiters-depth-3">)</span>
<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>

timeChart.addHook<span class="org-rainbow-delimiters-depth-1">(</span>d3Foresight.events.JUMP_TO_INDEX, <span class="org-rainbow-delimiters-depth-2">(</span>index<span class="org-rainbow-delimiters-depth-2">)</span> =&gt; <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">This is triggered when an event moves the</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">visualization to certain `index` in `timePoints`</span>
  console.log<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'chart moved to '</span> + index<span class="org-rainbow-delimiters-depth-3">)</span>
<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>addHook</code> returns a subscription token which can then be used to revoke that
hook using <code>removeHook</code>.
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">let</span> <span class="org-variable-name">token</span> = timeChart.addHook<span class="org-rainbow-delimiters-depth-1">(</span>
  d3Foresight.events.BACKWARD_INDEX,
  <span class="org-rainbow-delimiters-depth-2">()</span> =&gt; console.log<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'went back'</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>
timeChart.removeHook<span class="org-rainbow-delimiters-depth-1">(</span>token<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<br><br>
</div>
</div>
</div>
</body>
</html>
